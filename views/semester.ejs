<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semester <%= semester %></title>
    <link rel="stylesheet" href="/public/styles.css">
</head>
<body>
    <% var flag = 0 %>
    <!-- navbar -->
    <div class="">
        <nav>
            <!-- goto dashboard -->
             <!-- logout -->
              <ul>
                <li>
                    <form action="/" method="get">
                        <button type="submit" class="btn">Dashboard</button>
                    </form>
                </li>
                <li>
                    <form action="/user/logout" method="post">
                        <button type="submit" class="btn">logout</button>
                    </form>
                </li>
              </ul>
        </nav>
    </div>


    <div class="container">
        <h1>Semester  <%= semester %></h1>
    </div>

    <% if (subjects && subjects.length > 0) { %>
    <div class="container">
        <div>
            <table>
            <tr>
                <th>Subject</th>
                <th>Grade</th>
                <th>Credit</th>
                <th>Edit</th>
            </tr>
            <% subjects.forEach(function(subj) { %>
            <tr>
                <form action="/dashboard/subject-update" method="post">
                        <td>
                            <input type="hidden" name="subjectId" value="<%= subj._id %>">
                            <input type="text" name="Subject" value="<%= subj.Subject %>" required>
                        </td>
                        <td><input type="text" name="Grade" value="<%= subj.Grade %>" required></td>
                        <td><input type="number" name="Credit" value="<%= subj.Credit %>" required></td>
                        <td><button type="submit" class="samelinebtn">Update</button></td>
                    </form>
                </tr>
            <% }); %>
            </table>
        </div>
    </div>
    <% } %>


    <% if (numberOfSubjects) { %>
    <div class="container">
        <form action="/dashboard/subject-count" method="post">
            <input type="hidden" name="semester" value="<%= semester %>">
            <table>
                <tr>
                    <td><label>Update Number of Subjects</label></td>
                    <td><input type="number" name="numberOfSubjects" value="<%= numberOfSubjects %>" min="1" required></td>
                    <td><button class="samelinebtn" type="submit">Update</button></td>
                </tr>
            </table>
        </form>
    </div>
    <% } %>

    <% if (locals.showNumberOfSubjectsForm===true) { %>
    <div class="container">
        <form action="/dashboard/subject-count" method="post">
            <input type="hidden" name="semester" value="<%= semester %>">
            
            <table>
                <tr>
                    <td><label>Enter Number of Subjects for Semester <%= semester %></label></td>
                    <td><input type="number" name="numberOfSubjects" placeholder="1"></td>
                    <td><button class="samelinebtn">Submit</button></td>
                </tr>
            </table>
        </form>
    </div>
    <% } %>

    <% if (locals.subjectsSubmitted===false) { %>
    <div class="container">
        <form action="/dashboard/subjects" method="post">
            <input type="hidden" name="semester" value="<%= semester  %>">
            <input type="hidden" name="numberOfSubjects" value="<%= numberOfSubjects %>">
            <% for( let index = 0; index < locals.numberOfSubjects; index++ ) { %>
            <div>
                <label>Subject</label>
                <input type="text" name="subject<%= index+1 %>">
                <label>Grade</label>
                <input type="text" name="grade<%= index+1 %>">
                <label>Credit</label>
                <input type="number" name="credit<%= index+1 %>">
            </div>
            <% flag = 1 %>
            <% } %>

            <% if (flag===1) { %>
                <button class="samelinebtn">Submit</button>
            <% } %>
        </form>
    </div>
    <% } %>
    <% if (subjectsSubmitted === true ) { %>
    <script>
        // Calculate GPA in the browser
        const subjects = <%- JSON.stringify(subjects) %>;
        let totalPoints = 0;
        let totalCredits = 0;
        // You must define a grade-to-point mapping
        const gradeMap = { 'S': 10, 'A': 9, 'B': 8, 'C': 7, 'D': 6, 'E':5, 'F':0 };
        subjects.forEach(subj => {
            const points = gradeMap[subj.Grade] || 0;
            totalPoints += points * subj.Credit;
            totalCredits += subj.Credit;
        });
        const gpa = totalCredits ? (totalPoints / totalCredits).toFixed(2) : 0;
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('gpa-value').textContent = gpa;
            document.getElementById('gpa-input').value = gpa;
            document.getElementById('semesterCredit').value = totalCredits;
        });
    </script>
    <div class="container">
        <h3>Your GPA for Semester <%= semester %>: <span id="gpa-value"></span></h3>
        <form action="/dashboard/semester/gpa" method="post">
        <input type="hidden" name="semester" value="<%= semester %>">
        <input type="hidden" name="Gpa" id="gpa-input" value="">
        <input type="hidden" name="semesterCredit" id="semesterCredit" value="">
        <button class="samelinebtn" type="submit">Save GPA</button>
    </form>
    </div>
    <% } %>
        <div class="container">
        <div class="incontainer" style="background-color: rgb(32, 155, 249); color: white;">
            <p>Kunjan Pandey Â© 2025 </p>
        </div>
    </div>
</body>
</html>